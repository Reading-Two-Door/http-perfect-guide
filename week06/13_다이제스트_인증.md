## 공부 내용

- 다이제이트 인증은 기본 인증과 호환되는 더 안전한 대체재로서 개발됨
- 비밀번호를 절대 네트워크를 통해 평문으로 전송하지 않는다.
- 인증 체결을 가로채서 재현하는 것을 차단한다.
- 메시지 내용 위조 방지

### 비밀번호 지키기

- 요약된 비밀번호 값이 전달되기에 실제 풀 비밀번호가 전달되진 않는다.
  - 동일 비밀번호를 사용하는 경우 방지가 가능?
- 요약?은 단방향 함수로 동작하며 일반적으로 입력 가능한 무한 가지의 모든 입력값들을 유한한 범위의 압축으로 변환한다.
- 요약 비밀번호 자체도 비밀번호와 다름이 없기 때문에 난스(nonce)를 사용한다. 난스는 바뀔 때 마다 요약도 변경된다.

### 요약 비밀번호 계산

- 다이제스트 인증의 핵심은 공개된 정보, 비밀 정보, 난스 값을 조합한 단방향 요약이다.
- DM5 알고리즘을 기본값으로 사용한다.
- MD5 - A1 = <사용자>:<영역>:<비밀번호>
- MD5-sess - A1 = MD5(<사용자>:<영역>:<비밀번호>):<난스>:<c난스>
- 난스 만료 시 오래된 값임을 감수하고 받아들일 수 있고 새 난스 값과 함께 401재요청을 할 수 도 있다. 이 때 응답에 "stale=true"로 정의함으로써 새로 입력 없이 새 난스 값으로 요청을 다시 보낼 수 있다.
- 클라이언트가 다음 난스를 알고 있다면 미리 Authorization 헤더를 생성 후 요청/인증요구 사이클을 생략할 수 있다.
  - 다음 난스를 Authentication-Info에 담아서 보낸다.
    - 문제점 - 다음 난스를 미리 생성 시 사전인가로 트랜잭션 속도는 향상되지만 파이프라이닝은 쓸모가 없어진다.
  - 짧은 시간 난스 재사용을 허용
    - 문제점 - 재전송 공격이 성공하기 쉬워 지므로 보안성이 감소
  - 클라이언트와 서버가 동기화되어 있고 예측 가능한 난스 생성 알고리즘을 사용
    - 클라이언트와 서버가 순차적으로 같은 난스를 생성하도록 시간적으로 동기화가 가능하지만 인증 명세의 범위를 넘어서는 것이다.

### 보호 수준 향상

- qop 필드는 WWW-Authenticate, Authorization, Authentication-Info에 모두 존재할 수 있다.
- qop 필드는 클라이언트와 서버가 어떤 보호 기법을 어느 저도 수준으로 사용할 것인지 협상할 수 있게 해준다.
- 두 가지 초기 보호수준 값을 정의하는데 인증을 의미하는 auth, 인증 및 메시지 무결성을 의미하는 auth-int가 있다.
- qop가 auth-int일 때 계산되는 엔터티 본문은 메시지 본문의 해시가 아닌 엔터티 본문의 해시다.

### 실제 상황에 대한 고려

#### 다중 인증 요구

- 서버는 한 리소스에 대해 여러 인증을 요구할 수 있다.
- 다중 인증요구에 직면했을 때 클라이언트는 반드시 자신이 지원 가능한 가장 강력한 인증 메커니즘을 선택해야한다.
- 많은 브라우저가 오직 기본 인증만을 인식하고 그것이 서버가 제시한 첫 번째 인증 메커니즘일 것을 요구한다.
- 다중 옵션을 제공하는 경우 가장 허약한 연결부분에 대한 보안 우려가 있기에 서버는 기본 인증을 제한적으로 허용해야하며 관리자는 같은 비밀번호 사용의 위험에 대해 경고해야 한다.

#### 오류 처리

- 지시자나 그 값이 적절하지 않거나 요구된 지시자가 빠져 있는 경우 알맞은 응답은 400이다.
- 요청의 요약이 맞지 않으면 기록해 두는 것이 좋다. 반복된 실패는 공격자가 비밀번호 추측을 시도하고 있음을 의미한다.

#### 보호 공간

- 영역 값은, 접근한 서버의 루트 URL과 결합되어, 보호 공간을 정의한다.
- 영역은 서버의 보호된 리소스들을 자신만의 인증 제도와 인가 데이터베이스 어느 한 쪽 혹은 양쪽 모두를 가진 보호 영역의 집으로 분할할 수 있도록 해준다.
- 보호 공간은 어떤 자격이 자동으로 적용되는 영역을 결정

#### URI 다시 쓰기

- 프락시가 URI를 변경할 수 있는 동시에 다이제스트 인증은 URI 값의 무결성을 검사하므로, 이러한 변경에 의해 실패할 수 있다.

#### 캐시

- must-revalidate 일 경우 캐시는 응답의 엔터티를 다음 요청에 대한 응답을 위해 활용할 것이다. 그러나 원 서버가 새 요청을 인증할 수 있도록, 우선 그 요청의 헤더를 이용해서 재검사를 수행해야한다.
- public 일 경우 응답 엔터티는 그 다음에 오는 임의의 요청에 대한 응답으로 반환될 수 있다.

### 보안에 대한 고려사항

#### 헤더 부당 변경

- 헤더 부당 변경에 대해 항상 안전한 시스템을 제공하기 위해 양 종단 암호화나 헤더에 대한 디지털 서명이 필요
- 보호 수준에 대한 정보는 WWW-Authenticate와 Authorization에 담겨있다.

#### 재전송 공격

- 누군가 어떤 트랜잭션에서 엿들은 인증 자격을 다른 트랜잭션을 위해 사용하는 것
- 서버가 재전송된 자격을 승인해버렸다는 것은 같은 난스 값을 반복해서 사용한 것이다.
- 이 문제 완화를 위해 클라이언트IP주소, 타임스탬프, 리소스의 ETag, 개인 서버 키에 대한 요약을 포함하는 난스를 서버가 생성하도록 하는 것이다.
  - 깉은 사용자로부터 다른 프락시를 통과하게 될 수도 있는 프락시 팜은 사용할 수 없다.
- 매 트랜잭션 시 새로운 난스 값 생성이 베스트

#### 다중 인증 메커니즘

- 서버가 다중 인증 제도를 지원할 떄 WWW-Authenticate 헤더를 통해 선택지를 제공할 것이다.
- 문제 해결을 위해 클라이언트는 가장 강력한 인증 제도를 선택해야한다.
- 현실적으로 불가능하다면 가장 강력한 인증 제도만을 유지하는 프락시 서버를 사용하는 방법이 있다.

#### 사전 공격

- 비밀번호 추측 공격
- 문제 해결을 위해 크래킹하기 어렵도록 상대적을 ㅗ복잡한 비밀번호를 사용하는 것과 괜찮은 비밀번호 만료 정책 사용

#### 악의적인 프락시와 중간자 공격

- 신뢰할 수 있는 프락시의 신뢰도에 흠집을 낼 수 있는 것중 하나는 프락시 자신의 확장 인터페이스다.
- 가능한 해결책은 클라이언트가 사용자에게 인증의 강도를 시각적으로 보여주는것, 클라이언트가 가장 강력한 인증을 선택하도록 설정하는 것 등이 있다.
- 유일한 실패하지 않는 방법은 SSL을 사용하는 것

#### 선택 평문 공격

- 공격 서버는 미리 결정난 난스와 자주 쓰이는 비밀번호들로 응답의 집합을 생성하고 사전 비밀번호를 생성한다. 이후 트래픽을 차단 후 미리 결정된 난스를 클라이언트로 전송한다. 클라이언트로 부터 응답을 받을 때 대응되는 항목을 생성한 사전 비밀번호에서 찾아진다면 비밀번호를 탈취한 것이다.
- 많은 컴퓨터를 동원해 가능한 모든 비밀번호를 열거한다. - c난스 지시자를 사용하여 응답을 생성할 수 있도록 설정하면 방어 가능하다.

#### 비밀번호 저장

- 다이제스트 인증 비밀번호 파일이 유출되면 영역의 모든 문서는 즉각 공격자에게 노출된다.
  - 비밀번호 파일이 평문으로 된 비밀번호를 포함하고 있다고 생각하고 안전하게 보호한다.
  - 영역 이름이 유일함을 보장하며, 특정 영역으로 피해를 국소화한다.
- 다이제스트는 기본 인증에 비해 훨씬 탄탄하고 안전한 해결책을 제공함에도 콘텐츠에 대한 보안 측면에서는 어떠한 보호도 제공하지 못한다.

## 알게된 점

## 궁금한 점

- 335p 난스로 받았을 때 풀 비밀번호를 입력하면 알아서 알고리즘이 요약 비밀번호를 생성하는 것인가?
- 344p 무결성 - 송신자에 의해 인코딩이 적용되기도 전에 먼저 계산되고 수산자에 의해 제거된다.
