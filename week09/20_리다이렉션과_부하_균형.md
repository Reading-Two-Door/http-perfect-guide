## 공부 내용

- 리다이렉션 기술은 메시지가 프락시, 캐시, 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위해 사용한다.
- 리다이렉트는 신뢰 가능한 HTTP 트랜잭션, 지연 최소화, 네트워크 대역폭 절약의 이유로 현대 웹에서 필수다.
- 최적의 분산된 콘텐츠를 찾는 것을 도와주는 기법의 집합
- 리다이렉션은 부하 균형을 포함한다.
- 서버, 프락시, 캐시, 게이트웨이가 모두 서버의 특성을 갖고 있기 때문에, 많은 리다이렉션 기법이 모두에서 동작한다.
- 리다이렉션의 목표는 HTTP 메시지를 가용한 웹 서버로 가급적 빨리 보내는 것이다.
- DNS 리다이렉션을 비롯한 대부분의 기법들이 트래픽을 보내려는 곳이 어떤 서뱌에 상관없이 사용될 수 있는 반면 브라우저 설정과 같은 방법은 프락시로 향하는 리다이렉트 트래픽에 대해서만 사용할 수 있다.

### 일반적인 리다이렉션 방법

#### HTTP 리다이렉션

- 요청을 처리하는 서버는 가용한 것들 중 부하가 가장 적은 콘텐츠 서버를 찾아서 브라우저의 요청을 그 서버로 리다이렉트 한다.
- 웹 서버들이 광범위하게 분산되어 있다면 최선의 서버를 결정하는 것은 서버의 부하뿐 아니라 브라우저와 서버간 거리도 계산해야하기에 어려워 진다.
- 장점은 리다이렉트하는 서버가 클라이언트의 아이피 주소를 알고 있기에 보다 정보에 근거해 선택할 수 있다.
- 단점은 어떤 서버로 리다이렉트할지 결정하려면 원 서버는 상당히 많은 처리를 해야한다. 또 페이지 접근 시 두 번의 왕복이 필요하다.

#### DNS 리다이렉션

- DNS는 하나의 도메인에 여러 아이피 주소가 결부 되는 것을 허용하며, 여러 아이피 주소를 반환할 수 있다.

##### DNS 라운드 로빈

- 가장 흔한 동시에 가장 단순한 리다이렉션 기법
- 웹 서버 팜 전체에 대한 부하의 균형을 유지하기 위해 DNS 호스트 명 분석 기능을 사용한다.
- 순수한 부하 균형 전략이며, 서버에 대한 클라이언트의 상대적 위치나 서버의 현재 스트레스를 고려하지 않는다.
- 대부분의 DNS 클라이언트는 다중 주소 집합의 첫 번째 주소를 사용한다. 부하 균형을 위해, DNS 서버는 룩업이 끝났을 때마다 주소를 순환 시킨다.
- DNS서버는 캐싱의 문제로 한 클라이언트로 인한 부하를 제대로 분산하지 못한다.
- 향상된 DNS 서버는 주소의 순서를 결정하기 위해 다른 기법을 사용하기도 한다.
  - 부하 균형 알고리즘 - 웹 서버의 로드를 추적하고 가장 로드가 적은 웹 서버를 목록의 가장 위에 놓는다.
  - 근접 라우팅 알고리즘 - 웹 서버들의 팜이 지리적으로 분산되어 있는 경우, 사용자를 근처의 웹 서버로 보낸다.
  - 결함 마스킹 알고리즘 - 네트워크의 건강 상태를 모니터링하고 정전이나 장애를 피해 라우팅 한다.

#### 임의 캐스트 어드레싱

- 임의 캐스팅 어드레스에서, 여러 지리적으로 흩어진 웹 서버들은 정확히 같은 아이피 주소를 갖고 클라이언트 요청을 가장 가까운 서버로 보내주기위해 백본 라우터의 최단거리 라우팅 능력에 의존한다.
- 라우터 통신 프로토콜을 이용해 자신과 인접한 백본 라우터와 대화한다.

#### 아이피 맥 포워딩

- 패킷은 출발지와 목적지의 아이피 주소와 TCP 포트번호로 이루어진 레이어-4(전송 계층) 주소를 갖고 있다. 또한 각 패킷은 레이어-2(데이터 링크 계층) 장비가 주의를 기울여야 하는 레이어-2 주소인 MAC 주소도 갖고 있다.
- MAC 주소 포워딩은 점 대 점으로만 가능하기 때문에, 서버나 프락시는 스위치와 한 홉 거리에 위치해야한다.

#### 아이피 주소 포워딩

- 레이어4 스위치는 패킷에 대해 TCP/IP 어드레싱을 검증하고 패킷을 목적지 아이피 주소의 변경에 따라 라우팅한다.
- 맥 포워딩과 달리 한 홉 거리에 있을 필요가 없다.
- 네트워크 주소 변환(NAT) - 스위치에서 업스트림 위치를 판별할 수만 있으면 일반적인 레이어-3(네트워크 계층) 종단간 인터넷 라우팅이 패킷을 올바른 위치로 보내준다.
- 라우팅 대칭성 문제가 있다. 스위치는 반드시 그 커넥션을 통해 클라이언트에게 응답을 돌려줘야 한다.
  - 응답의 귀환 경로 두 가지 제어 방법
  1. 패킷의 출발지 아이피를 스위치의 아이피로 변경
  2. 출발지 아이피가 클라이언트의 아이피로 계속 남아있다면, 서버에서 클라이언트로 바로 가는 경로가 존재하지 않아야 한다.

#### 네트워크 구성요소 제어 프로토콜(NECP)

- 아이피 패킷을 전달하는 라우터나 스위치 같은 네트워크 구성요소들이 웹 서버나 프락시 캐시와 같이 애플리케이션 계층 요청을 처리하는 서버 구성요소들과 대화할 수 있게 해준다.
- NECP는 부하 균형을 명시적으로 지원하지는 않는다. 다만 서버 구성요소가 네트워크 구성요소에게 부하 균형 정보를 제공할 수 있는 방법을 제공하여, 서버 구성요소가 적합하다고 판단한 대로 네트워크 구성요소가 부하 균형을 유지할 수 있다.

### 프락시 리다이렉션 방법

- 웹 브라우저 같은 클라이언트는 명시적 브라우저 설정, 동적인 자동 설정, 자연스러운 인터셉트 등으로 프락시로 가는 길을 알 수 있다.
- 프락시는 결과적으로 클라이언트 요청을 다른 프락시로 리다이렉트 할 수 있다.

#### 명시적 브라우저 설정

- 대부분의 브라우저에는 프락시 서버에 접촉하기 위해 프락시 이름, 아이피 주소, 포트번호를 설정할 수 있다.
- 단점
  - 프락시 설정을 한 브라우저는 프락시가 응답하지 않아도 원 서버와 접촉하지 않는다.
  - 네트워크 아키텍처를 변경했을 때 변경사항을 최종 사용자에게 전파하기 어렵다. 브라우저에 개입해 설정을 변경하는 주체가 사용자이기 때문

#### 프락시 자동 설정(PAC)

- 브라우저가 동적으로 설정하는 방법으로 프락시 자동설정(PAC) 프로토콜이라고 불린다.
- 브라우저가 URL별로 접촉해야할 프락시를 지정한 PAC파일을 찾도록 한다. 반드시 PAC파일을 얻기 위해 지정된 서버에 접촉하도록 설정되어야 한다.
- PAC파일은 다음의 함수를 정의해야하는 자바스크립트 파일로 브라우저가 어디서 이 URL을 요청해야 하는지를 지정한 문자열을 반환한다.
- 프락시의 위치가 변경되는 경우 PAC파일이 서버에서 업데이트되기 때문에 자동으로 네트워크 아키텍처 안에서의 변경에 맞는 올바른 프락시에 접촉할 수 있도록 해줄 수 있다.

#### 웹 프락시 자동발견 프로토콜(WPAD)

- 웹브라우저가 근처의 프락시를 찾아내어 사용할 수 있게 해주는 방버븡ㄹ 제공하는 것을 목적으로 한다.
- HTTP 클라이언트가 PAC파일의 위치를 알아내고 그 파일을 이용해서 적절한 프락시 서버의 이름을 알아낼 수 있도록 한다. 직접적으로 프락시 서버의 이름을 알아내지 않는 이유는 PAC파일에 의해 추가적으로 제공되는 기능들이 활요될 수 없기 때문이다.
- CURL === PAC파일 URL
- WPAD는 적절한 PAC파일 CURL을 결정하기 위해 여러 가지 리소스 발견 기법들을 사용한다.
- 클라이언에게는 오직 DHCP와 DNS에게 잘 알려진 호스트 명 기법만이 요구된다.
- PAC 파일이 CURL에서 성공적으로 발견되면 과정은 종료되고 아니면 미리 정의된 리소스 발견 요청의 연쇄를 중단한 시점에서 다시 시작한다. 모든 발견 메커니즘을 시도 후에도 PAC파일을 찾지 못하면 프락시 서버를 사용하지 않는 것으로 설정된다.
- 한 번 후보 CURL이 생성되면 WPAD 클라이언트는 보통 그 CURL로 적절한 CFILE 포맷정보가 담긴 Accept 헤더를 포함한 GET 요청을 만든다.

### 캐시 리다이렉션 방법

- 일반적인 리다이렉션나 프락시 리다이렉션 보다 신뢰성이 높고, 고성능에, 콘텐츠 지각 디스패칭까지 가능하게 하려고 하기 때문에 프로토콜이 복잡하다.

#### WCCP 리다이렉션

- 라우터와 캐시 사이에 대화를 관리하여 라우터가 캐시를 검사하고 특정 종류의 트래픽을 특정 캐시로 보낼 수 있게 해준다.
- WCCP를 사용할 수 있는 라우터와 다른 캐시와 의사소통할 수 있는 캐시가 포함된 네트워크가 필요하다.
- 라우터 집합과 대상이 되는 캐시들이 WCCP 서비스 그룹을 구성한다. 서비스 그룹 설정은 트래픽 이동?과 부하를 캐시에게 어떻게 분산되어야 하는지 명시한다.
- 서비스 그룹이 HTTP 트래픽을 리다이렉션 하도록 설정되어 있다면, 서비스 그룹의 라우터는 HTTP 요청을 서비스 그룹의 캐시로 보낸다.
- HTTP 요청이 라우터에 도착했을 때, 라우터는 캐시 중 하나를 선택한다.
- 라우터는 요청 패킷을, 캐시의 아이피 주소와 함께 캡슐화하거나 아이피 맥 포워딩을 하여 캐시로 보낸다.
- 캐시가 요청을 처리할 수 없다면 패킷은 라우터로 되돌아온다.
- 서비스 그룹은 지속적으로 가용성 확인을 위해 하트비트 메시지를 교환한다.
- 서비스 그룹
  - 서비스 그룹은 WCCP를 지우너해 WCCP 메시지를 교환할 수 있는 라우터와 캐시들의 집합으로 구성
  - 이 라우터들은 웹 트래픽을 서비스 그룹의 캐시로 보낸다.
  - 서비스 그룹 설정은 어떻게 트래픽이 서비스 그룹의 캐시들로 분산되는지 결정한다.
- GRE 패킷 캡슐화
  - WCCP를 지원하는 라우터들은 HTTP 패킷을 특정 서버의 IP 주소와 함꼐 캡슐화함으로써 그 서버에 리다이렉트한다. 이 패킷 캡슐화는 일반 라우터 캡슐화임을 나타내는 IP헤더 proto 필드도 포함하고 있다.
  - 패킷이 캡슐화되어 있기 때문에 클라이언트 아이피 주소를 잃어버리지 않는다.
- WCCP 부하 균형
  - WCCP 라우터와 수신 서버들은 동작 중임을 다른 장비들이 알 수 있도록 하트비트 메시지를 서로 교환한다. 특정 수신 서버가 하트비트 메시지를 보내지 않는다면 트래픽 요청을 리다이렉트 하지 않는다.

#### 인터넷 캐시 프로토콜(ICP)

- 캐시들이 형제 캐시에서 일어난 캐시 적중을 찾아볼 수 있도록 해준다.
- 캐시 클러스터링 프로토콜
- ICP는 객체 발견 프로토콜이다. 근처의 캐시 모두 특정 URL을 갖고 있는지 한번에 확인한다. HIT 또는 MISS로 응답
- 단순하고 가벼우며, ICP메시지는 파싱하기 쉽도록 네트워크 바이트 순서에 따라 32비트 크기로 맞추어진 구조체다.
- ICP메시지는 효율을 위해 UDP다이어그램을 전송된다. UDP 프로토콜을 따르므로 타임아웃을 설정해 데이터그램의 손실을 감지한다.

#### 캐시 배열 라우팅 프로토콜(CARP)

- 프락시 서버의 배열이 클라이언트 시점에서 하나의 논리적인 캐시처럼 보이도록 관리해준다.
- ICP의 대안으로 ICP의 콘텐츠의 쓸모없는 복제본도 갖고 있는 중복된 엔트리가 허용되는 문제를 해결하고자 했다.
- CARP는 각 구성요소 서버가 전체 캐시된 문서의 일부만 갖고있는 하나의 큰 서버처럼 동작한다.
- 중복된 웹 캐시에 대한 사본의 중복을 피함으로써 웹 객체를 더많이 보관할 수 있는 장점이 있지만, 어느 하나의 프락시가 실패하더라도 상당량의 캐시를 재배치 해야하는 단점이 있다.

#### 하이퍼텍스트 캐싱 프로토콜(HTCP)

- ICP가 HTTP/0/9를 염두로 설계 되었기에 단순히 요청 URL만 보내는 것은 정확한 응답을 가져오지 못하는 결과를 가져올 수 있다.
- HTCP는 형제들이 URL과 모든 요청 및 응답 헤더를 사용하여 서로에게 문서의 존재 여부에 대한 질의를 할 수 있도록 해줌으로써 적중이 아님에도 적중으로 잘못 처리될 확률을 줄인다.
- 더 나아가 서로의 캐시 안에 있는 선택된 문서의 추가 및 삭제를 모니터링하고 요청할 수 있게, 그리고 캐시된 문서에 대한 캐싱 정책을 변경할 수 있게 한다.

## 알게된 점

### MAC주소 vs IP주소

MAC 주소는 하드웨어 기반으로 생성된 물리적 주소(Physical Address)이고, IP 주소는 소프트웨어 기반으로 생성된 논리적 주소(Logical Address)입니다. 때문에 MAC 주소는 변경될 수 없는 반면 IP 주소는 변경될 수 있습니다.

컴퓨터 간 통신이 일어날 때 MAC 주소는 네트워크에 있는 고유한 컴퓨터를 식별하는 데 사용됩니다. 반면 IP 주소는 네트워크에 참여한 컴퓨터와 네트워크의 연결 상태를 식별하는데 사용됩니다. MAC 주소는 미디어 연결 주소라고 부르고, IP 주소는 인터넷 프로토콜 주소라고 부릅니다.

컴퓨터 간 통신 과정은 OSI 7계층으로 이루어져있습니다. MAC 주소는 데이터 링크 계층에서 작동하며, IP 주소는 네트워크 계층에서 작동합니다. 이때 MAC 주소를 찾아주는 게 ARP 프로토콜, IP 주소를 찾아주는 건 RARP 프로토콜입니다.

### 레이어와 스위치

레이어 4 스위치와 전송 계층은 서로 다른 개념입니다.

전송 계층 (Layer 4): OSI(Open Systems Interconnection) 모델의 네 번째 계층으로, 데이터의 전송을 담당합니다. 이 계층에서는 데이터를 세그먼트로 분할하고, 이를 패킷으로 패키징하며, 이러한 패킷들이 목적지까지 안전하게 도달할 수 있도록 관리합니다. TCP(Transmission Control Protocol)와 UDP(User Datagram Protocol)는 이 계층에서 작동하는 주요 프로토콜입니다.
레이어 4 스위치: 네트워크 장비 중 하나로서, OSI 모델의 Layer 4인 전송 계층까지 고려하여 특정 패킷을 처리하고 라우팅하는 역할을 합니다. 즉, 포트 번호와 프로토콜 타입(TCP/UDP 등)에 따라 특정 서버나 장치로 트래픽을 전달하는 기능을 수행합니다.
따라서 레이어 4 스위치는 전송 계층에 위치한 프로토콜과 정보를 활용하지만, 그 자체가 "전송 계층"은 아닙니다.

### 홉

네트워크에서 "홉(hop)"은 패킷이 소스(출발지)에서 목적지까지 도달하는 데 필요한 중간 경유점 또는 점프를 의미합니다. 각 홉은 일반적으로 네트워크 라우터나 스위치 등의 장비를 지칭

## 궁금한 점

536p 아이피 주소 포워딩 귀환 경로 두 가지 방법 무슨 말인가?
